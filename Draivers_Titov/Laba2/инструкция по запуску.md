---------------------------------------------- ПОЛНЫЙ АЛГОРИТМ ЗАПУСКА SPAN-ДРАЙВЕРА

Создаем виртуальные интерфейсы

sudo ip link delete veth0 2>/dev/null || true
sudo ip link add veth0 type veth peer name veth1
sudo ip link set veth0 up
sudo ip link set veth1 up
sudo ip addr add 10.0.0.1/24 dev veth0
sudo ip addr add 10.0.0.2/24 dev veth1


Проверяем что интерфейсы создались

ip link show | grep veth
ip addr show veth0
ip addr show veth1

Компилируем драйвер 
make

Загружаем драйвер

sudo rmmod span_driver 2>/dev/null || true
sudo insmod span_driver.ko source_if=veth0 mirror_if=veth1

Проверяем что драйвер загрузился
lsmod | grep span_driver
dmesg | tail -5

Запускаем Wireshark для мониторинга (в отдельных терминалах)
sudo wireshark -i veth1
sudo wireshark -i veth0

Генерируем тестовый трафик (в терминале 1)
# Очищаем ARP кэш
sudo ip neigh flush dev veth0

# Генерируем ARP запросы и ping
ping -c 5 -I veth0 10.0.0.2

# Генерируем UDP трафик
for i in 1 2 3; do
    echo "SPAN_TEST_$i" | nc -u -w 0 10.0.0.2 9999
    sleep 1
done

Проверяем работу
# Смотрим логи драйвера
dmesg | grep SPAN | tail -10

# Смотрим статистику пакетов
cat /sys/class/net/veth1/statistics/rx_packets
cat /sys/class/net/veth0/statistics/tx_packets

----------------------------------------- запуск с помощью sender и reader

# Удаляем старые адреса
sudo ip addr del 10.0.0.1/24 dev veth0 2>/dev/null || true
sudo ip addr del 10.0.0.2/24 dev veth1 2>/dev/null || true

# Назначаем новые адреса
sudo ip addr add 192.168.1.10/24 dev veth0
sudo ip addr add 192.168.1.11/24 dev veth1

# Проверяем
ip addr show veth0
ip addr show veth1


ШАГ 2: Перезагружаем драйвер
sudo rmmod span_driver
sudo insmod span_driver.ko source_if=veth0 mirror_if=veth1


sudo ./reader veth1

sudo ./sender veth0


